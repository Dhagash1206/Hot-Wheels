<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HOT Wheels</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      /* Product image styling */
      .product img {
        width: 250px;
        height: 300px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      /* Sale images styling */
      .sale-images img {
        width: 220px; /* Increased width */
        height: 150px; /* Increased height */
        object-fit: cover;
        margin: 10px; /* Added more spacing */
        border-radius: 8px; /* Slightly larger border radius */
        border: 3px solid #fff; /* Increased border thickness */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Added shadow for better visibility */
        transition: transform 0.3s ease; /* Smooth hover effect */
      }

      .sale-images img:hover {
        transform: scale(1.1); /* Slight zoom on hover */
      }
      /* Logo styling */
      .logo {
        width: 150px;
        height: auto;
      }
      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        background: linear-gradient(to right, #8b0000, #b22222);
        height: 70px;
        border-radius: 12px;
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        border: 2px solid #7a0000;
      }
      .logo:hover {
        transform: scale(1.1);
        transition: transform 0.3s ease;
      }
    </style>
    <script>
      $(document).ready(function () {
        $("body").css(
          "background",
          "linear-gradient(to bottom, #14203a, #1a2d4a 20%, #23518c 100%, #3578c7 60%)"
        );
        $("#newsletter-form").submit(function (e) {
          e.preventDefault();
          // Show a non-blocking toast at the top instead of bottom
          let toast = document.getElementById("newsletter-toast");
          if (!toast) {
            toast = document.createElement("div");
            toast.id = "newsletter-toast";
            toast.style.cssText =
              "position:fixed;top:20px;right:20px;background:#323232;color:#fff;padding:12px 16px;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.2);z-index:9999;opacity:0;transform:translateY(-10px);transition:opacity .3s,transform .3s;";
            document.body.appendChild(toast);
          }
          toast.textContent = "Thanks for subscribing! Please check your mail.";
          requestAnimationFrame(() => {
            toast.style.opacity = "1";
            toast.style.transform = "translateY(0)";
          });
          setTimeout(() => {
            toast.style.opacity = "0";
            toast.style.transform = "translateY(-10px)";
          }, 2500);
          this.reset();
        });
      });
    </script>
  </head>
  <body>
    <a href="index.html" class="logo-container">
      <img src="images/hwlogo.png" alt="HOT Wheels Logo" class="logo" />
    </a>
    <nav>
      <a href="#shop">Shop</a>
      <a href="about.html">About</a>
      <a href="contactUs.html">Contact</a>
      <div class="cart-icon" onclick="toggleCart()">
        ðŸ›’ <span class="cart-count">0</span>
      </div>
    </nav>

    <div class="cart-sidebar" id="cart-sidebar">
      <div class="cart-header">
        <h3>Your Cart</h3>
        <span class="close-cart" onclick="toggleCart()">&times;</span>
      </div>
      <div class="cart-items"></div>
      <div class="cart-total">
        <h4>Total: â‚¹<span id="cart-total-amount">0</span></h4>
        <button onclick="checkout()">Checkout</button>
      </div>
    </div>

    <div
      class="sale-banner"
      style="
        background-image: url('images/wp1.jpg');
        background-size: cover;
        background-position: center;
      "
    >
      <div class="sale-text">
        <h2>ðŸ”¥ SUMMER MADNESS SALE ðŸ”¥</h2>
        <p>NOW THRU 12/25</p>
        <p>Flat 40% OFF Selected Items</p>
        <a href="#shop"><button>SHOP NOW</button></a>
      </div>
      <div class="sale-images">
        <img src="images/jp1.jpg" alt="Car Collection" />
        <img src="images/jp2.jpg" alt="Car Collection" />
        <img src="images/jp3.jpg" alt="Car Collection" />
      </div>
    </div>

    <div class="container" id="shop">
      <div class="product">
        <img src="images/jp1.jpg" alt="Die-cast vehicle" />
        <h3>Die-cast vehicle</h3>
        <p>â‚¹899</p>
        <button onclick="addtoc('Die-cast vehicle', 899)">Add to Cart</button>
      </div>
      <div class="product">
        <img src="images/jp2.jpg" alt="Monster Truck" />
        <h3>Monster Truck</h3>
        <p>â‚¹299</p>
        <button onclick="addtoc('Monster Truck', 299)">Add to Cart</button>
      </div>
      <div class="product">
        <img src="images/jp3.jpg" alt="RC Cars" />
        <h3>RC Cars</h3>
        <p>â‚¹399</p>
        <button onclick="addtoc('RC Cars', 399)">Add to Cart</button>
      </div>
      <div class="product">
        <img src="images/jp4.jpg" alt="Top Picks" />
        <h3>Top Picks</h3>
        <p>â‚¹199</p>
        <button onclick="addtoc('Top Picks', 199)">Add to Cart</button>
      </div>
      <div class="product">
        <img src="images/jp5.jpg" alt="Collector" />
        <h3>Collector</h3>
        <p>â‚¹399</p>
        <button onclick="addtoc('Collector', 399)">Add to Cart</button>
      </div>
      <div class="product">
        <img src="images/jp7.jpg" alt="23 Special Collection" />
        <h3>23 Special Collection</h3>
        <p>â‚¹399</p>
        <button onclick="addtoc('23 Special Collection', 399)">
          Add to Cart
        </button>
      </div>
      <div class="product">
        <img src="images/jp8.jpg" alt="Vintage Collection" />
        <h3>Vintage Collection</h3>
        <p>â‚¹399</p>
        <button onclick="addtoc('Vintage Collection', 399)">Add to Cart</button>
      </div>
    </div>

    <div class="container" id="chatbot">
      <button
        id="chatbot-launcher"
        aria-label="Open chat" onclick="(function(){const c=prompt('Enter 1 to go to the promotions page, or 2 to open chat and add an item via the chat input:'); if(!c) return; if(c.trim()==='1'){window.location.href='sale.html';} else if(c.trim()==='2'){ if(window.HWChatbot) window.HWChatbot.open(); setTimeout(()=>{ const inp=document.getElementById('chatbot-input'); const msgs=document.getElementById('chatbot-messages'); if(msgs){ const m=document.createElement('div'); m.className='chatbot-message bot'; const b=document.createElement('div'); b.className='chatbot-bubble'; b.textContent='Type the product name here to add it to your cart (e.g. \"Monster Truck\").'; m.appendChild(b); msgs.appendChild(m); msgs.scrollTop=msgs.scrollHeight; } if(inp){ inp.value=''; inp.focus(); } },200); } })()"
        title="Chat with HOT Wheels Assistant"
      >
        ðŸ’¬
      </button>

      <div class="chatbot-widget" id="chatbot-widget" aria-hidden="false">
        <div class="chatbot-header">
          <span>HOT Wheels Assistant</span>
          <button id="chatbot-toggle" aria-label="Toggle chat">âœ•</button>
        </div>
        <div
          class="chatbot-messages"
          id="chatbot-messages"
          role="log"
          aria-live="polite"
        ></div>
        <form id="chatbot-form" class="chatbot-form" autocomplete="off">
          <input
            id="chatbot-input"
            type="text"
            placeholder="Ask about products, shipping, offers..."
            required
          />
          <button type="submit">Send</button>
        </form>
      </div>

      <style>
        /* launcher button */
        #chatbot-launcher {
          position: fixed;
          right: 24px;
          bottom: 24px;
          width: 56px;
          height: 56px;
          border-radius: 50%;
          background: linear-gradient(90deg, #8b0000, #b22222);
          color: #fff;
          border: none;
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
          cursor: pointer;
          font-size: 22px;
          z-index: 9998;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        /* widget base */
        .chatbot-widget {
          position: fixed;
          right: 20px;
          bottom: 20px;
          width: 320px;
          max-height: 420px;
          display: flex;
          flex-direction: column;
          background: #ffffff;
          border-radius: 10px;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
          overflow: hidden;
          font-family: "Poppins", sans-serif;
          z-index: 9999;
          transform: translateY(12px);
          opacity: 0;
          transition: opacity 0.22s ease, transform 0.22s ease;
          pointer-events: none;
        }
        .chatbot-widget[aria-hidden="false"] {
          transform: translateY(0);
          opacity: 1;
          pointer-events: auto;
        }
        .chatbot-header {
          background: linear-gradient(90deg, #8b0000, #b22222);
          color: #fff;
          padding: 10px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          font-weight: 600;
        }
        .chatbot-header button {
          background: transparent;
          border: none;
          color: #fff;
          font-size: 16px;
          cursor: pointer;
        }
        .chatbot-messages {
          padding: 12px;
          overflow-y: auto;
          flex: 1 1 auto;
          background: linear-gradient(180deg, #f7f9fc, #eef6ff);
        }
        .chatbot-form {
          display: flex;
          gap: 8px;
          padding: 10px;
          border-top: 1px solid #eee;
          background: #fff;
        }
        .chatbot-form input {
          flex: 1;
          padding: 8px 10px;
          border-radius: 6px;
          border: 1px solid #ddd;
          outline: none;
        }
        .chatbot-form button {
          background: #23518c;
          color: #fff;
          border: none;
          padding: 8px 12px;
          border-radius: 6px;
          cursor: pointer;
        }
        .chatbot-message {
          margin-bottom: 10px;
          display: flex;
          gap: 8px;
          align-items: flex-end;
        }
        .chatbot-message.bot {
          justify-content: flex-start;
        }
        .chatbot-message.user {
          justify-content: flex-end;
        }
        .chatbot-bubble {
          max-width: 75%;
          padding: 8px 12px;
          border-radius: 12px;
          font-size: 14px;
          line-height: 1.3;
        }
        .chatbot-message.bot .chatbot-bubble {
          background: #eef2ff;
          color: #111;
          border-bottom-left-radius: 4px;
        }
        .chatbot-message.user .chatbot-bubble {
          background: #23518c;
          color: #fff;
          border-bottom-right-radius: 4px;
        }
        .chatbot-suggest {
          margin-top: 6px;
          display: flex;
          gap: 6px;
          flex-wrap: wrap;
        }
        .chatbot-suggest button {
          background: #fff;
          border: 1px solid #ddd;
          padding: 6px 8px;
          border-radius: 6px;
          cursor: pointer;
        }
        @media (max-width: 400px) {
          .chatbot-widget {
            right: 10px;
            left: 10px;
            width: auto;
          }
          #chatbot-launcher {
            right: 12px;
            bottom: 12px;
          }
        }
      </style>

      <script>
        (function () {
          const widget = document.getElementById("chatbot-widget");
          const toggle = document.getElementById("chatbot-toggle");
          const messages = document.getElementById("chatbot-messages");
          const form = document.getElementById("chatbot-form");
          const input = document.getElementById("chatbot-input");
          const launcher = document.getElementById("chatbot-launcher");

          const HISTORY_KEY = "hw_chat_history_v1";
          const OPEN_KEY = "hw_chat_open_v1";

          // load history
          let history = [];
          try {
            history = JSON.parse(sessionStorage.getItem(HISTORY_KEY) || "[]");
          } catch (e) {
            history = [];
          }
          history
            .slice(-20)
            .forEach((m) => renderMessage(m.sender, m.text, false));

          // restore open state
          const wasOpen = sessionStorage.getItem(OPEN_KEY) === "1";
          setOpenState(Boolean(wasOpen), false);

          if (!history.length && !wasOpen) {
            // initial greeting stored to history but not auto-open
            respond(
              "bot",
              "Hi! I'm the HOT Wheels Assistant. Ask about products, prices, shipping or type 'help'."
            );
          }

          launcher.addEventListener("click", () => setOpenState(true, true));
          toggle.addEventListener("click", () => setOpenState(false, true));

          // keyboard: Esc to close, Ctrl/Cmd+K to open
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") setOpenState(false, true);
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k") {
              e.preventDefault();
              setOpenState(true, true);
              input.focus();
            }
          });

          form.addEventListener("submit", function (e) {
            e.preventDefault();
            const text = input.value.trim();
            if (!text) return;
            renderMessage("user", text, true);
            input.value = "";
            handleUserMessage(text);
          });

          function setOpenState(open, save) {
            widget.setAttribute("aria-hidden", String(!open));
            widget.style.display = open ? "flex" : "none";
            launcher.style.display = open ? "none" : "flex";
            if (open) {
              messages.scrollTop = messages.scrollHeight;
              input.focus();
            }
            if (save) sessionStorage.setItem(OPEN_KEY, open ? "1" : "0");
          }

          function saveToHistory(sender, text) {
            history.push({ sender, text, t: Date.now() });
            sessionStorage.setItem(
              HISTORY_KEY,
              JSON.stringify(history.slice(-50))
            );
          }

          function renderMessage(sender, text, shouldScroll) {
            const wrap = document.createElement("div");
            wrap.className =
              "chatbot-message " + (sender === "user" ? "user" : "bot");
            const bubble = document.createElement("div");
            bubble.className = "chatbot-bubble";
            bubble.textContent = text;
            wrap.appendChild(bubble);
            messages.appendChild(wrap);
            if (shouldScroll !== false)
              messages.scrollTop = messages.scrollHeight;
            saveToHistory(sender, text);
          }

          function respond(sender, text) {
            setTimeout(() => renderMessage(sender, text, true), 220);
          }

          function handleUserMessage(text) {
            const t = text.toLowerCase();

            const products = [
              {
                k: "die-cast",
                name: "Die-cast vehicle",
                price: 899,
                key: "die-cast",
              },
              {
                k: "monster",
                name: "Monster Truck",
                price: 299,
                key: "monster",
              },
              { k: "rc", name: "RC Cars", price: 399, key: "rc" },
              {
                k: "collector",
                name: "Collector",
                price: 399,
                key: "collector",
              },
              {
                k: "vintage",
                name: "Vintage Collection",
                price: 399,
                key: "vintage",
              },
            ];

            if (/(hi|hello|hey)\b/.test(t))
              return respond(
                "bot",
                "Hello! How can I help today? Try: 'show sale', 'cart', or ask about a product name."
              );
            if (t.includes("help"))
              return respond(
                "bot",
                "You can ask: 'Show sale', 'What are your hours?', 'shipping', or the product name (e.g. 'Monster Truck')."
              );
            if (
              t.includes("sale") ||
              t.includes("offer") ||
              t.includes("discount")
            )
              return respond(
                "bot",
                "Current Summer Madness Sale: Flat 40% OFF selected items. See the banner or shop section."
              );
            if (t.includes("hours") || t.includes("open"))
              return respond(
                "bot",
                "We're online 24/7 for browsing. Orders are processed during business hours (Mon-Fri, 9am-6pm)."
              );
            if (t.includes("shipping"))
              return respond(
                "bot",
                "We provide standard and express shipping. Shipping cost depends on location and cart weight at checkout."
              );
            if (t.includes("cart") || t.includes("checkout"))
              return respond(
                "bot",
                "Open your cart using the ðŸ›’ icon at the top-right. When ready, click PLACE ORDER."
              );
            if (/thank|thanks/.test(t))
              return respond(
                "bot",
                "You're welcome! Anything else I can help with?"
              );

            for (const p of products) {
              if (t.includes(p.k) || t.includes(p.name.toLowerCase())) {
                respond(
                  "bot",
                  `${p.name} â€” â‚¹${p.price}. Click to add to cart.`
                );
                setTimeout(() => {
                  const btn = document.createElement("button");
                  btn.textContent = `Add ${p.name} to cart`;
                  btn.className = "chatbot-suggest-btn";
                  btn.style.cursor = "pointer";
                  btn.addEventListener("click", () => {
                    if (typeof addtoc === "function") {
                      addtoc(p.name, p.price);
                      respond("bot", `${p.name} added to cart.`);
                    } else {
                      respond(
                        "bot",
                        "Add-to-cart not available here. Please use the product listing."
                      );
                    }
                  });
                  const container = document.createElement("div");
                  container.className = "chatbot-suggest";
                  container.appendChild(btn);
                  messages.appendChild(container);
                  messages.scrollTop = messages.scrollHeight;
                }, 300);
                return;
              }
            }

            respond(
              "bot",
              "I didn't catch that. Try asking about a product name (e.g. 'RC Cars') or type 'help'."
            );
          }

          window.HWChatbot = {
            send: (txt) => {
              setOpenState(true, true);
              renderMessage("user", txt, true);
              handleUserMessage(txt);
            },
            open: () => setOpenState(true, true),
            close: () => setOpenState(false, true),
          };
        })();
      </script>
    </div>

    <div class="newsletter">
      <h2>Subscribe to Our Newsletter</h2>
      <p><>Get updates about new products and special offers!</p>
      <form id="newsletter-form" class="newsletter-form">
        <input type="email" placeholder="Enter your email" required />
        <button type="submit">Subscribe</button>
      </form>
    </div>

    <div class="order">
      <button onclick="goToOrder()">PLACE ORDER</button>
    </div>

    <script>
      let cart = [];
      let cartTotal = 0;

      // Load cart if exists
      if (localStorage.getItem("cart")) {
        cart = JSON.parse(localStorage.getItem("cart"));
        updateCart();
      }

      function toggleCart() {
        document.getElementById("cart-sidebar").classList.toggle("active");
      }

      function addtoc(productName, price) {
        cart.push({ name: productName, price: price });
        updateCart();
        // Show non-blocking toast (same as newsletter)
        let toast = document.getElementById("newsletter-toast");
        if (!toast) {
          toast = document.createElement("div");
          toast.id = "newsletter-toast";
          toast.style.cssText =
            "position:fixed;top:20px;right:20px;background:#323232;color:#fff;padding:12px 16px;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.2);z-index:9999;opacity:0;transform:translateY(-10px);transition:opacity .3s,transform .3s;";
          document.body.appendChild(toast);
        }
        toast.textContent = "Item added to cart successfully!";
        requestAnimationFrame(() => {
          toast.style.opacity = "1";
          toast.style.transform = "translateY(0)";
        });
        clearTimeout(toast.dismissTimer);
        toast.dismissTimer = setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.transform = "translateY(-10px)";
        }, 2500);
      }

      function updateCart() {
        const cartItems = document.querySelector(".cart-items");
        const cartCount = document.querySelector(".cart-count");
        const cartTotalAmount = document.getElementById("cart-total-amount");

        cartItems.innerHTML = "";
        cartTotal = 0;

        cart.forEach((item, index) => {
          cartTotal += item.price;
          cartItems.innerHTML += ` 
                    <div class="cart-item">
                        <div class="cart-item-details">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-price">â‚¹${item.price}</div>
                        </div>
                        <button onclick="removeFromCart(${index})">&times;</button>
                    </div>
                `;
        });

        cartCount.textContent = cart.length;
        cartTotalAmount.textContent = cartTotal;

        // Save cart to localStorage
        localStorage.setItem("cart", JSON.stringify(cart));
      }

      function removeFromCart(index) {
        cart.splice(index, 1);
        updateCart();
      }

      function checkout() {
        if (cart.length === 0) {
          // Show non-blocking toast (same as newsletter)
          let toast = document.getElementById("newsletter-toast");
          if (!toast) {
            toast = document.createElement("div");
            toast.id = "newsletter-toast";
            toast.style.cssText =
              "position:fixed;top:20px;right:20px;background:#323232;color:#fff;padding:12px 16px;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.2);z-index:9999;opacity:0;transform:translateY(-10px);transition:opacity .3s,transform .3s;";
            document.body.appendChild(toast);
          }
          toast.textContent = "Cart is empty!";
          requestAnimationFrame(() => {
            toast.style.opacity = "1";
            toast.style.transform = "translateY(0)";
          });
          clearTimeout(toast.dismissTimer);
          toast.dismissTimer = setTimeout(() => {
            toast.style.opacity = "0";
            toast.style.transform = "translateY(-10px)";
          }, 2500);
          return;
        }
        // Redirect to the order page with total as a query parameter
        window.location.href = `order.html?total=${cartTotal}`;
      }

      function goToOrder() {
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        window.location.href = `order.html?total=${total}`;
      }
    </script>
  </body>
</html>
